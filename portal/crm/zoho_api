# crm_sync/zoho_api.py

import requests
from django.conf import settings

def get_zoho_access_token():
    token_url = "https://accounts.zoho.com/oauth/v2/token"
    data = {
        "refresh_token": settings.ZOHO_REFRESH_TOKEN,
        "client_id": settings.ZOHO_CLIENT_ID,
        "client_secret": settings.ZOHO_CLIENT_SECRET,
        "grant_type": "refresh_token"
    }
    response = requests.post(token_url, data=data)
    return response.json().get("access_token")

def fetch_zoho_contacts():
    access_token = get_zoho_access_token()
    headers = {
        "Authorization": f"Zoho-oauthtoken {access_token}"
    }
    url = "https://www.zohoapis.com/crm/v2/Contacts"
    response = requests.get(url, headers=headers)
    return response.json()
